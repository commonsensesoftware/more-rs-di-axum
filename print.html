<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>More DI for Axum Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="guide/registration.html"><strong aria-hidden="true">2.</strong> Service Registration</a></li><li class="chapter-item expanded "><a href="guide/resolution.html"><strong aria-hidden="true">3.</strong> Service Resolution</a></li><li class="chapter-item expanded "><a href="guide/best_practices.html"><strong aria-hidden="true">4.</strong> Best Practices</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">More DI for Axum Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/commonsensesoftware/more-di-axum/tree/main/guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><code>more-di-axum</code> is a crate which provides dependency injection (DI) extensions for the <a href="https://crates.io/crates/axum">axum</a>
web framework. Any <code>trait</code> or <code>struct</code> can be used as an injected service.</p>
<p><code>axum</code> provides a <a href="https://github.com/tokio-rs/axum/blob/main/examples/error-handling-and-dependency-injection/src/main.rs">dependency injection example</a>; however, it is very limited. <code>axum</code> does not have nor provide a
fully-fledged DI framework. <em>State</em> in <code>axum</code> must support <code>Clone</code> and is copied many times within the pipeline. In particular,
the native <em>State</em> model does not intrinsically support a <em>scoped</em> (e.g. per-request) lifetime. This is a limitation of
<code>Clone</code>. A <em>state</em> can be wrapped in <code>Arc</code> as a <em>singleton</em>; otherwise, it is <em>transient</em>. <code>more-di-axum</code> brings full support
for various lifetimes by layering over the <a href="https://crates.io/crates/more-di">more-di</a> library and makes them ergonomic to
consume within <code>axum</code>. Since <code>more-di</code> is a complete DI framework, swapping out dependency registration in different contexts,
such as testing, is trivial.</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p><code>more-di-axum</code> is free and open source. You can find the source code on <a href="https://github.com/commonsensesoftware/more-rs-di-axum">GitHub</a>
and issues and feature requests can be posted on the <a href="https://github.com/commonsensesoftware/more-rs-di-axum/issues">GitHub issue tracker</a>.
<code>more-di-axum</code> relies on the community to fix bugs and add features: if you'd like to contribute, please read the
<a href="https://github.com/commonsensesoftware/more-rs-di-axum/blob/main/CONTRIBUTING.md">CONTRIBUTING</a> guide and consider opening
a <a href="https://github.com/commonsensesoftware/more-rs-di-axum/pulls">pull request</a>.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>This project is licensed under the <a href="https://github.com/commonsensesoftware/more-rs-di-axum/blob/main/LICENSE">MIT</a> license.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>The simplest way to get started is to install the crate using the default features.</p>
<pre><code class="language-bash">cargo add more-di-axum
</code></pre>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>The following example reworks the <code>axum</code> <a href="https://github.com/tokio-rs/axum/blob/main/examples/error-handling-and-dependency-injection/src/main.rs">dependency injection example</a>
with full dependency injection support using <a href="https://crates.io/crates/more-di">more-di</a>.</p>
<pre><code class="language-rust">use axum::{
    async_trait,
    extract::Path,
    http::StatusCode,
    response::{IntoResponse, Response},
    routing::{get, post},
    Json, Router,
};
use di::*;
use di_axum::*;
use serde::{Deserialize, Serialize};
use serde_json::json;
use tokio::net::TcpListener;
use uuid::Uuid;

#[tokio::main]
async fn main() {
    let provider = ServiceCollection::new()
        .add(ExampleUserRepo::singleton())
        .build_provider()
        .unwrap();

    let app = Router::new()
        .route(&quot;/users/:id&quot;, get(one_user))
        .route(&quot;/users&quot;, post(new_user))
        .with_provider(provider);

    let listener = TcpListener::bind(&quot;127.0.0.1:3000&quot;).await.unwrap();
    
    println!(&quot;listening on: {}&quot;, listener.local_addr().unwrap());

    axum::serve(listener, app).await.unwrap();
}

async fn one_user(
    Path(id): Path&lt;Uuid&gt;,
    Inject(repo): Inject&lt;dyn UserRepo + Send + Sync&gt;,
) -&gt; Result&lt;Json&lt;User&gt;, AppError&gt; {
    let user = repo.find(user_id).await?;
    Ok(user.into())
}

async fn new_user(
    Inject(repo): Inject&lt;dyn UserRepo + Send + Sync&gt;,
    Json(params): Json&lt;CreateUser&gt;,
) -&gt; Result&lt;Json&lt;User&gt;, AppError&gt; {
    let user = repo.create(params).await?;
    Ok(user.into())
}

#[derive(Debug)]
enum UserRepoError {
    #[allow(dead_code)]
    NotFound,
    #[allow(dead_code)]
    InvalidUserName,
}

enum AppError {
    UserRepo(UserRepoError),
}

#[async_trait]
trait UserRepo {
    async fn find(&amp;self, user_id: Uuid) -&gt; Result&lt;User, UserRepoError&gt;;
    async fn create(&amp;self, params: CreateUser) -&gt; Result&lt;User, UserRepoError&gt;;
}

#[derive(Debug, Serialize)]
struct User {
    id: Uuid,
    username: String,
}

#[derive(Debug, Deserialize)]
#[allow(dead_code)]
struct CreateUser {
    username: String,
}

#[injectable(UserRepo + Send + Sync)]
struct ExampleUserRepo;

#[async_trait]
impl UserRepo for ExampleUserRepo {
    async fn find(&amp;self, _user_id: Uuid) -&gt; Result&lt;User, UserRepoError&gt; {
        unimplemented!()
    }

    async fn create(&amp;self, _params: CreateUser) -&gt; Result&lt;User, UserRepoError&gt; {
        unimplemented!()
    }
}

impl From&lt;UserRepoError&gt; for AppError {
    fn from(inner: UserRepoError) -&gt; Self {
        AppError::UserRepo(inner)
    }
}

impl IntoResponse for AppError {
    fn into_response(self) -&gt; Response {
        let (status, error_message) = match self {
            AppError::UserRepo(UserRepoError::NotFound) =&gt; {
                (StatusCode::NOT_FOUND, &quot;User not found&quot;)
            }
            AppError::UserRepo(UserRepoError::InvalidUserName) =&gt; {
                (StatusCode::UNPROCESSABLE_ENTITY, &quot;Invalid user name&quot;)
            }
        };

        let body = Json(json!({
            &quot;error&quot;: error_message,
        }));

        (status, body).into_response()
    }
}</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="service-registration"><a class="header" href="#service-registration">Service Registration</a></h1>
<p><code>axum</code> handlers execute in an asynchronous context. This requires that an injected service must be thread-safe. <code>axum</code> imposes that an such service must implement <code>Send</code> and <code>Sync</code>.
Most structures will already satisfy this requirement and is generated by the compiler. If it doesn't, then the struct will have to be wrapped by another struct that satisfies this
requirement. A trait, on the other hand, has several options and depends on the trait definition itself. The method you chose to use is largely based on your preference.</p>
<h2 id="thread-safe-trait"><a class="header" href="#thread-safe-trait">Thread-Safe Trait</a></h2>
<p>A trait declares it is thread-safe if it requires implementing <code>Send</code> and <code>Sync</code>.</p>
<pre><code class="language-rust">trait Service: Send + Sync {}

#[injectable(Service)]
struct ServiceImpl;

impl Service for ServiceImpl {}

async fn handler(Inject(service): Inject&lt;dyn Service&gt;) {}</code></pre>
<h2 id="multiple-trait-implementation"><a class="header" href="#multiple-trait-implementation">Multiple Trait Implementation</a></h2>
<p>If the original trait does not declare thread safety with <code>Send</code> and <code>Sync</code>, then a struct implementation can directly specify that it is thread-safe.</p>
<pre><code class="language-rust">trait Service {}

#[injectable(Service + Send + Sync)]
struct ServiceImpl;

impl Service for ServiceImpl {}

async fn handler(Inject(service): Inject&lt;dyn Service + Send + Sync&gt;) {}</code></pre>
<h2 id="trait-unification"><a class="header" href="#trait-unification">Trait Unification</a></h2>
<p>If the original trait does not declare thread safety with <code>Send</code> and <code>Sync</code>, another alterative is to unify the trait with <code>Send</code> and <code>Sync</code> in a new trait.
You might chose this approach for better usage ergonomics.</p>
<pre><code class="language-rust">trait Service {}

trait ServiceAsync: Service + Send + Sync {}

#[injectable(ServiceAsync)]
struct ServiceImpl;

impl Service for ServiceImpl {}
impl ServiceAsync for ServiceImpl {}

async fn handler(Inject(service): Inject&lt;dyn ServiceAsync&gt;) {}</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!--
This file contains links that can be shared across pages. RustDoc links cannot currently
be used by mdBook directly. Links are stable on crates.io so we can centralize what is
required in this file, albeit manually.

REF: https://github.com/rust-lang/mdBook/issues/1356
REF: https://github.com/rust-lang/cargo/issues/739
REF: https://github.com/tag1consulting/goose/issues/320
-->
<h1 id="service-resolution"><a class="header" href="#service-resolution">Service Resolution</a></h1>
<p>Services are resolved and injected using the functions provided by <a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html"><code>ServiceProvider</code></a>. A new <em>scope</em> is created during each
HTTP request before the handler is executed.</p>
<div class="table-wrapper"><table><thead><tr><th>Extactor</th><th>Function</th></tr></thead><tbody>
<tr><td><code>TryInject</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get"><code>get</code></a></td></tr>
<tr><td><code>TryInjectMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_mut"><code>get_mut</code></a></td></tr>
<tr><td><code>TryInjectWithKey</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_by_key"><code>get_by_key</code></a></td></tr>
<tr><td><code>InjectWithKeyMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_by_key_mut"><code>get_by_key_mut</code></a></td></tr>
<tr><td><code>InjectAll</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_all"><code>get_all</code></a></td></tr>
<tr><td><code>InjectAllMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_all_mut"><code>get_all_mut</code></a></td></tr>
<tr><td><code>InjectAllWithKey</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_all_by_key"><code>get_all_by_key</code></a></td></tr>
<tr><td><code>InjectWithKeyMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_all_by_key_mut"><code>get_all_by_key_mut</code></a></td></tr>
<tr><td><code>Inject</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_required"><code>get_required</code></a></td></tr>
<tr><td><code>InjectMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_required_mut"><code>get_required_mut</code></a></td></tr>
<tr><td><code>InjectWithKey</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_required_by_key"><code>get_required_by_key</code></a></td></tr>
<tr><td><code>InjectWithKeyMut</code></td><td><a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceProvider.html#method.get_required_by_key_mut"><code>get_required_by_key_mut</code></a></td></tr>
</tbody></table>
</div>
<p>If resolution fails, the HTTP request will short-circuit with HTTP status code 500 - Internal Server Error.</p>
<div style="break-before: page; page-break-before: always;"></div><!--
This file contains links that can be shared across pages. RustDoc links cannot currently
be used by mdBook directly. Links are stable on crates.io so we can centralize what is
required in this file, albeit manually.

REF: https://github.com/rust-lang/mdBook/issues/1356
REF: https://github.com/rust-lang/cargo/issues/739
REF: https://github.com/tag1consulting/goose/issues/320
-->
<h1 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h1>
<p>To make it easy to test an application, it is recommended that you expose a function that configures the default set of services. This will make it simple to use the same default configuration as the application and replace only the parts that are necessary for testing.</p>
<p>If a service can be replaced, then it should be registered using <a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceCollection.html#method.try_add"><code>try_add</code></a>. A service can still be replaced after it has been registered, but <a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceCollection.html#method.try_add"><code>try_add</code></a> will skip the process altogether if the service has already been registered.</p>
<pre><code class="language-rust">use crate::*;
use axum::{
    async_trait,
    extract::Path,
    http::StatusCode,
    response::{IntoResponse, Response},
    routing::{get, post},
    Json, Router,
};
use serde::{Deserialize, Serialize};
use serde_json::json;
use tokio::net::TcpListener;
use uuid::Uuid;

// provide a function that can be called with the expected set of services
fn add_default_services(services: &amp;mut ServiceCollection) {
    services.try_add(ExampleUserRepo::scoped());
}

// provide a function that can build a router representing the application
fn build_app(services: ServiceCollection) -&gt; Router {
    Router::new()
        .route(&quot;/users/:id&quot;, get(one_user))
        .route(&quot;/users&quot;, post(new_user))
        .with_provider(services.build_provider().unwrap())
}

#[tokio::main]
async fn main() {
    let mut services = ServiceCollection::new();

    add_default_services(&amp;mut services);

    let app = build_app(services);
    let listener = TcpListener::bind(&quot;127.0.0.1:3000&quot;).await.unwrap();
    
    println!(&quot;listening on: {}&quot;, listener.local_addr().unwrap());

    axum::serve(listener, app).await.unwrap();
}

#[async_trait]
trait UserRepo {
    async fn find(&amp;self, user_id: Uuid) -&gt; Result&lt;User, UserRepoError&gt;;
    async fn create(&amp;self, params: CreateUser) -&gt; Result&lt;User, UserRepoError&gt;;
}

#[injectable(UserRepo + Send + Sync)]
struct ExampleUserRepo;

#[async_trait]
impl UserRepo for ExampleUserRepo {
    async fn find(&amp;self, _user_id: Uuid) -&gt; Result&lt;User, UserRepoError&gt; {
        unimplemented!()
    }

    async fn create(&amp;self, _params: CreateUser) -&gt; Result&lt;User, UserRepoError&gt; {
        unimplemented!()
    }
}

async fn one_user(
    Path(id): Path&lt;Uuid&gt;,
    Inject(repo): Inject&lt;dyn UserRepo + Send + Sync&gt;,
) -&gt; Result&lt;Json&lt;User&gt;, AppError&gt; {
    let user = repo.find(user_id).await?;
    Ok(user.into())
}

async fn new_user(
    Inject(repo): Inject&lt;dyn UserRepo + Send + Sync&gt;,
    Json(params): Json&lt;CreateUser&gt;,
) -&gt; Result&lt;Json&lt;User&gt;, AppError&gt; {
    let user = repo.create(params).await?;
    Ok(user.into())
}</code></pre>
<p>You can now easily test your application by replacing on the only necessary services. In the following test, we:</p>
<ol>
<li>Create a <code>TestUserRepo</code> to simulate the behavior of a <code>dyn UserRepo</code></li>
<li>Register <code>TestUserRepo</code> in a new <code>ServiceCollection</code></li>
<li>Register all other default services
<ul>
<li>Since <code>dyn UserRepo</code> has been registered as <code>TestUserRepo</code> and <a href="https://docs.rs/more-di/3.1.0/di/struct.ServiceCollection.html#method.try_add"><code>try_add</code></a> was used, the default registration is skipped</li>
</ul>
</li>
<li>Create a <code>Router</code> representing the application</li>
<li>Run the application with a test client</li>
<li>Invoke the HTTP <code>GET</code> method to return a single <code>User</code></li>
</ol>
<pre><code class="language-rust">use super::*;
use crate::*;
use di::*;

#[tokio::test]
async fn get_should_return_user() {
    // arrange
    #[injectable(UserRepo + Send + Sync)]
    struct TestUserRepo;

    #[async_trait]
    impl UserRepo for TestUserRepo {
        async fn find(&amp;self, _user_id: Uuid) -&gt; Result&lt;User, UserRepoError&gt; {
            Ok(User::default())
        }

        async fn create(&amp;self, _params: CreateUser) -&gt; Result&lt;User, UserRepoError&gt; {
            unimplemented!()
        }
    }

    let mut services = ServiceCollection::new();

    services.add(TestUserRepo::scoped());
    add_default_services(services);

    let app = build_app(services);
    let client = TestClient::new(app);

    // act
    let response = client.get(&quot;/user/b51565c273c04bb4ac179232c90b20af&quot;).send().await;

    // assert
    assert_eq!(response.status(), StatusCode::OK);
}</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
